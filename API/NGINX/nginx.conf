user ammanvedi;
worker_processes 4;
pid /run/nginx.pid;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;


	gzip on;
	gzip_disable "msie6";


	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;


	upload_progress proxied 1m;

	server{
		client_max_body_size 150m;
		listen 8080;
  		more_set_headers 'Access-Control-Allow-Origin: *';
  		more_set_headers 'Access-Control-Allow-Methods: GET, POST, OPTIONS, PUT, DELETE';
  		more_set_headers 'Access-Control-Allow-Credentials: true';
  		more_set_headers 'Access-Control-Allow-Headers: Origin,Content-Type,Accept';
		
		location /upload {
					
			if ($request_method = OPTIONS ) {
      				add_header Content-Length 0;
      				add_header Content-Type text/plain;
      				return 204;
    			}

                                upload_set_form_field $upload_field_name.name "$upload_file_name";
                                upload_set_form_field $upload_field_name.content_type "$upload_content_type";
                                upload_set_form_field $upload_field_name.path "$upload_tmp_path";
                                upload_aggregate_form_field "$upload_field_name.md5" "$upload_file_md5";
                                upload_aggregate_form_field "$upload_field_name.size" "$upload_file_size";
                                upload_pass_form_field "^submit$|^description$";
				upload_pass_args on;
				upload_pass @clientfrontend;
				upload_store /tmp 1;
				upload_store_access user:r;
				upload_cleanup 400 404 499 500-505;
		}
	
		location @clientfrontend {

			rewrite ^/upload/(.*)$ /$1;
			proxy_set_header 'Access-Control-Allow-Origin' '*';
			proxy_pass https://localhost:4000;
		}
	
	}


}

